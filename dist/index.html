<!DOCTYPE html>
<html lang="en">
  <head>
    <style>html{visibility: hidden;opacity:0;}</style>
    <meta charset="utf-8" />
    <title>flure playground</title>
    <meta name="description" content="flure" />
    <meta name="author" content="karnpapon boonput" />
    <link rel="icon" type="image/png" href="public/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="fengari-web.js" type="text/javascript"></script>
    <script src="pbm2canvas.js" type="text/javascript"></script>
    <script src="bundle.js"></script>
  </head>
  <body>

    <script type="text/javascript">
      window.onload = function(){

        renderWelcomeCanvas()

        let output = document.getElementById("flure-console")

        function save(){
          if(!window.flure_value) return false
          const bb = new Blob([window.flure_value ], { type: 'text/plain' });
          const a = document.createElement('a');
          a.download = 'flure_image.pbm';
          a.href = window.URL.createObjectURL(bb);
          a.click();
        }

        output.addEventListener("flure_image_result_starting", function(){
          // let loading_elem = document.getElementById("canvas_loading")
          // loading_elem.style.display = "block"
         })

        output.addEventListener("flure_image_result_processing", function(e){
            let canvas = document.getElementById("flure_canvas")
            if(!window.flure_value) return false
            pbm2canvas(window.flure_value, canvas, e.detail) 
        })

        output.addEventListener("flure_image_result_end", function(){
          // let loading_elem = document.getElementById("canvas_loading")
          // loading_elem.style.display = "none"
          let save_btn = document.getElementById("save-btn")
          save_btn.removeEventListener("click", save)
          save_btn.disabled = false
          save_btn.style.backgroundColor = "white"
          save_btn.addEventListener("click", () => save())
        })
      }

      function renderWelcomeCanvas(){
        let width = 800 
        let height = 800
        let canvas = document.getElementById("flure_canvas")
        let ctx = canvas.getContext("2d");

        canvas.height = height;
        canvas.width = width*2;
        ctx.font = "20px monospace";
        ctx.fillText("flure playground", 40, 50);

        ctx.font = "14px monospace";
        ctx.fillText("a playground for \"flure\", a stack-based programming language", 40, 30*3);
        ctx.fillText("to create binary graphic (1-bit).", 40, 30*4);
        ctx.fillText("inspired by FORTH language.", 40, 30*5);
      }
   
    </script>

    <div class="h-screen p-10 bg-white dark:bg-gray-900 antialiased flex-col">
      <div class="flex h-full">
        <div class="relative flex justify-center items-center h-auto  rounded-xl overflow-hidden w-[70%]">
          <div class="relative w-full h-full object-contain object-center rounded-xl overflow-hidden">
            <div class="absolute left-0 bottom-0 z-[99] mb-2 ml-2">
              <button id="save-btn" type="button" disabled class="inset-0 py-2 px-2 text-xs font-medium focus:outline-none bg-gray-100 text-gray-400 hover:bg-gray-200 rounded-lg border border-gray-200  focus:z-10 focus:ring-4 focus:ring-gray-200 ">
                <img src="public/download.png" class="w-4 h-4" alt="save image (.pbm)">
              </button>
            </div>
            <canvas id="flure_canvas" class="absolute z-10 rounded-xl h-full"/>
          </div>
        </div>
        <div class="flex flex-col pl-6">
          <div class="flex flex-1">
            <div class="flex flex-col text-xs">
              <h1 class="text-xl font-bold">Guides</h1>
              <p><code>flure</code> use reverse polish notation (RPN) eg <code>10 10 +</code> will return <code>20</code></p>
              <li><code>x</code> and <code>y</code> correspond to x,y coordinates</li>
              <li>arithmatics = <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></li>
              <li>bitwise = <code>&</code>, <code>|</code>, <code>^</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code></li>
              <li>stack = <code>pop</code>, <code>push</code></li>
              <li>show stack = <code>show</code></li>
              <li>to exit = <code>bye</code></li>
              <li>function declaration (or <code>word</code> in <code>FORTH</code>'s term) = <code> : <function_name> &lt;...args&gt; ; </code> eg. <code> : loop 1 - dup 0 = if else loop then ; </code></li>
              <li>compile mode = <code>:</code>, delimited compile mode = <code>;</code></li>
              <li>basic control flow <code>&lt;case&gt; if &lt;if_case&gt; else &lt;else_case&gt; then ;</code></li>
              <li>comments = <code>( &lt;...comments&gt; )</code></li>
              <li><code>immediate</code>ly call a function = eg. <code> : bob 20 20 + ; immediate</code>, will return <code>40</code> without calling <code>bob</code> function.</li>
              <li>core = (<code>-1</code> =  <code>true</code>, <code>0</code> = <code>false</code>)</li>
              <div class="ml-4">
                <li><code>=</code>(equal) , <code>&lt;&gt;</code></code>(not equal)</li>
                <li><code>and</code> , <code>or</code> , <code>&gt;</code>(greater_than), <code>&lt;</code>(less_than)</li>
                <li><code>dup</code>(duplicate) , <code>2dup</code>(double duplicate) , <code>swap</code> , <code>rot</code>(rotate)</li>
                <li><code>abs</code>(absolute number)</li>
                <li><code>%</code>(modulo), <code>!</code>(cast to 0 or 1)</li>
              </div>
  
              <br/>
              <h1 class="text-xl font-bold">Examples</h1>
              <p>each line below will computes a different results</p>
              <b>** [note] current computed image size = <code>128px * 128px</code> **</b>
              <p class="pb-1">(these number (<code>128px</code> and <code>128px</code>) will be substituted by <code>w</code> and <code>h</code> in the future.)</p>
              <li><code>x y ^ 5 % !</code></li>
              <li><code>x y + abs x y - abs 1 + ^ 2 &lt;&lt; 5 % !</code></li>
              <li><code>x 2 * y % !</code></li>
              <li><code>x 128 2 / - 64 2 / * y 128 2 / - % !</code></li>
            </div>
  
          </div>
  
          <div class="repl bg-gray-100 w-full p-2 text-xs text-gray-600 rounded-md flex flex-col h-[200px]">
            <code id="flure-console"></code>
            <div class="flure-input-container self-end w-full">
                <label id="flure-prompt" for="flure-input">&gt;</label>
                <textarea autofocus class="w-full" id="flure-input" rows="1" placeholder="try here, for quick tutorial: `x y ^ 5 % !` then ShiftEnter"></textarea>
            </div>
        </div>
        <div class="pt-4 bottom-0 left-0 w-full dark:bg-gray-700 md:flex md:items-center md:justify-between">
          <!-- <div id="canvas_loading" class="hidden -translate-y-2 h-[10px] text-xl">
            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_nOfF{animation:spinner_qtyZ 2s cubic-bezier(0.36,.6,.31,1) infinite}.spinner_fVhf{animation-delay:-.5s}.spinner_piVe{animation-delay:-1s}.spinner_MSNs{animation-delay:-1.5s}@keyframes spinner_qtyZ{0%{r:0}25%{r:3px;cx:4px}50%{r:3px;cx:12px}75%{r:3px;cx:20px}100%{r:0;cx:20px}}</style><circle class="spinner_nOfF" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_fVhf" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_piVe" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_MSNs" cx="4" cy="12" r="3"/></svg>
          </div> -->
          <div class="w-full flex mt-4 space-x-6 justify-end md:mt-0">
            <span class="text-xs  text-gray-500 dark:text-gray-300 sm:text-center">MIT License, 2023, Bangkok Thailand  <a target="_blank" class="underline" href="https://github.com/karnpapon/flure">https://github.com/karnpapon/flure</a></span>
          </div>
        </div>
      </div>

      </div>
      
    </div>

    
    <script src="lua/web-cli.lua" type="application/lua" async></script>
  </body>
</html>
